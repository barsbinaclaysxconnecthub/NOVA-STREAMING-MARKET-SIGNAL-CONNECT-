<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaTrade Withdrawal</title>
<link rel="stylesheet" href="style.css">
<style>
/* ================= LIVE BALANCE ================= */
#balance { font-variant-numeric: tabular-nums; }
</style>
</head>
<body>

<div class="card">
<h2>Withdrawal Simulation</h2>
<p>Academic Project â€“ No Real Transactions</p>
<button onclick="toggleTheme()">Toggle Theme</button>
</div>

<div class="card">
<h3>Available Balance</h3>
<h2 id="balance">$500.00</h2>
</div>

<div class="card">
<h3>Select Coin Pair</h3>
<select id="coin">
<option value="BTC">BTC</option>
<option value="ETH">ETH</option>
<option value="SOL">SOL</option>
<option value="ADA">ADA</option>
<option value="XRP">XRP</option>
<option value="DOGE">DOGE</option>
<option value="DOT">DOT</option>
<option value="LTC">LTC</option>
<option value="AVAX">AVAX</option>
<option value="TRX">TRX</option>
</select>

<input type="text" id="wallet" placeholder="Enter Wallet Address">
<input type="number" id="amount" placeholder="Enter Withdrawal Amount">

<button onclick="unlockWithdrawal()">Request Withdrawal</button>

<p id="message"></p>
</div>

<div class="card">
<h3>Withdrawal History</h3>
<ul id="history"></ul>
</div>

<div class="nav">
<button onclick="location.href='trade.html'">Back to Trade</button>
<button onclick="location.href='home.html'">Dashboard</button>
</div>

<script>
// ================= THEME PERSISTENCE =================
function toggleTheme(){
  document.body.classList.toggle('dark');
  localStorage.setItem('theme',document.body.className);
}
document.addEventListener('DOMContentLoaded',()=>{
  const theme = localStorage.getItem('theme');
  if(theme) document.body.className = theme;
});

// ================= BALANCE =================
let balanceEl = document.getElementById("balance");
let historyEl = document.getElementById("history");

// load balance from trade.html
let balance = parseFloat(localStorage.getItem("balance")) || 500;
balanceEl.innerText = "$" + balance.toFixed(2);

// ================= WALLET VALIDATION =================
function validateWallet(coin, address){
 const patterns = {
   BTC: /^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$/,
   ETH: /^0x[a-fA-F0-9]{40}$/,
   SOL: /^[1-9A-HJ-NP-Za-km-z]{32,44}$/,
   ADA: /^addr1[a-z0-9]{50,}$/,
   XRP: /^r[0-9a-zA-Z]{24,34}$/,
   DOGE: /^D{1}[5-9A-HJ-NP-U]{1}[1-9A-HJ-NP-Za-km-z]{32}$/,
   DOT: /^[1-9A-HJ-NP-Za-km-z]{47,48}$/,
   LTC: /^[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}$/,
   AVAX: /^X-[a-zA-Z0-9]{30,}$/,
   TRX: /^T[a-zA-Z0-9]{33}$/
 };
 return patterns[coin].test(address);
}

// ================= WITHDRAWAL FUNCTION =================
function unlockWithdrawal(){
 let coin = document.getElementById("coin").value;
 let wallet = document.getElementById("wallet").value.trim();
 let amount = parseFloat(document.getElementById("amount").value);
 let msg = document.getElementById("message");

 if(!validateWallet(coin, wallet)){
   msg.innerText = "Invalid wallet address format for " + coin;
   return;
 }

 if(!amount || amount <= 0){
   msg.innerText = "Enter valid withdrawal amount.";
   return;
 }

 if(balance - amount < 500){
   msg.innerText = "Cannot withdraw below $500 base capital.";
   return;
 }

 msg.innerText = "Withdrawal unlocking... (1 minute simulation)";

 setTimeout(()=>{
   balance -= amount;
   localStorage.setItem("balance", balance); // update global balance
   saveHistory(`Withdrawal ${coin} - $${amount}`);
   msg.innerText = "Withdrawal Successful (Simulation)";
   balanceEl.innerText = "$" + balance.toFixed(2);
 }, 60000);
}

// ================= HISTORY FUNCTIONS =================
function saveHistory(text){
 let history = JSON.parse(localStorage.getItem("history")) || [];
 history.push(text + " | " + new Date().toLocaleTimeString());
 localStorage.setItem("history", JSON.stringify(history));
 loadHistory();
}

function loadHistory(){
 historyEl.innerHTML = "";
 let list = JSON.parse(localStorage.getItem("history")) || [];
 list.forEach(item=>{
   historyEl.innerHTML += `<li>${item}</li>`;
 });
}

// load existing history on page load
loadHistory();
</script>

</body>
</html>
