<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaTrade Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
  <h2>NovaTrade Market</h2>
  <p>Academic Simulation Only</p>
  <button onclick="toggleTheme()">Toggle Theme</button>
</div>

<div id="market"></div>

<div class="nav">
  <button onclick="location.href='trade.html'">Trade</button>
  <button onclick="location.href='index.html'">Logout</button>
</div>

<script>
const coins = [
  "bitcoin",
  "ethereum",
  "solana",
  "cardano",
  "ripple",
  "dogecoin",
  "polkadot",
  "litecoin",
  "avalanche-2",
  "tron"
];

let previousData = {};

// Apply saved theme from localStorage
if(localStorage.getItem('theme') === 'dark'){
  document.body.classList.add('dark');
}

// Toggle theme function
function toggleTheme(){
  document.body.classList.toggle('dark');
  localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}

// Load market data from CoinGecko
async function loadMarket(){
  try {
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coins.join(',')}&vs_currencies=usd`);
    const data = await res.json();
    const container = document.getElementById("market");
    container.innerHTML = "";

    coins.forEach(coin => {
      if(data[coin]){
        let changeClass = "";
        if(previousData[coin]){
          if(data[coin].usd > previousData[coin]) changeClass = "green";
          else if(data[coin].usd < previousData[coin]) changeClass = "red";
        }

        container.innerHTML += `
          <div class="card">
            <h3>${coin.charAt(0).toUpperCase() + coin.slice(1)}</h3>
            <p class="price ${changeClass}">$${data[coin].usd.toLocaleString()}</p>
          </div>
        `;
      }
    });

    // Update previous data
    coins.forEach(coin => previousData[coin] = data[coin]?.usd);

  } catch(err) {
    console.error("Error fetching market data:", err);
  }
}

// Initial load and refresh every 15s
loadMarket();
setInterval(loadMarket, 15000);
</script>

<!-- Only leave price change colors inline -->
<style>
.green { color: #28a745; }
.red { color: #dc3545; }
</style>

</body>
</html>
